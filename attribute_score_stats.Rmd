---
title: "Eavlauting Attribute Scores Across Cases"
author: "Meghan Fletcher"
date: "1/31/2022"
output: 
  html_document:
    theme: flatly
    code_folding: hide
    toc: true
    toc_float: true
---

```{r setup, include=FALSE, message = FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

#Load libraries
library(ggplot2)
library(tidyverse)
library(janitor)
library(googlesheets4)
library(here)
library(kableExtra)
library(broom)
library(ggpubr)
```


# Read in the data from Google Sheets
```{r, results=FALSE, message = FALSE, warning = FALSE, class.source = 'fold-hide', warning = FALSE}
aguion_barnacle <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1WfGsKOT0gFSN1yHUObDNSQflqd5avodSuf3kOZLTyLk/edit#gid=1947230832", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Aguion",
             reference = "aguion1",
             .after = "question_id")


#######################################################################################################################
burden_sardine <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1TkB-P94xgRssmcbAuzwoh0BlDdvUfYHO7vWjK6r2pxs/edit#gid=1965519914", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names()%>% 
  add_column(case_study = "Burden",
             reference = "burden1",
             .after = "question_id")



#######################################################################################################################
dickey_collas_eur <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1hfXTM5hwe0iLWQQmrc31-xruOV3SUixuxqRSuqC8ydA/edit#gid=1707192308", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Dickey_Collas",
             reference = "dickey_collas1",
             .after = "question_id")



#######################################################################################################################
eurich_clam <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1ZEIev1lcoD6Lxu3otzDCfbJJSiPJoZeyYbTvBXb_S9U/edit#gid=1453404713", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Eurich",
             reference = "eurich1",
             .after = "question_id")



#####################################################################################################################################
free_crab <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/12zMb5el0QAB-CdZdmdKjWw5Krbwx7farqlUvbN08HEg/edit#gid=390317686", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Free",
             reference = "free1",
             .after = "question_id")



#######################################################################################################################
golden_madagascar <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1w99nN8C_Vd82j4Y23g2ZG_kuEh_Jc2HkW6lnLkhzeCU/edit#gid=390607640", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Golden",
             reference = "golden1",
             .after = "question_id")



#######################################################################################################################
friedman_fiji <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/13fgkP1xHZB6gZqXUBHuylaC3ImCDIDTFFjqQ8RAoV-s/edit#gid=476628697", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Friedman",
             reference = "friedman1",
             .after = "question_id")



#######################################################################################################################
hollowed_bering_sea <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1YOYZ9T7RR_8OkqQIWeZobhS-3yaEbKmuAVz16Nrrz9g/edit#gid=9514874", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Hollowed",
             reference = "hollowed1",
             .after = "question_id")



########################################################################################################################
kisara_squid <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1RX1iUmEKsOUmuPZkn4SMA6zts9TTPz-gi0D6XFrY1RQ/edit#gid=934077877", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Kisara",
             reference = "kisara1",
             .after = "question_id") 



###########################################################################################################################
kleisner_jfi <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1YM1wc6F0SgGIoBcTvSjVyLJquE6-6Chk1dPFoLiXuQY/edit#gid=1865610127", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Kleisner",
             reference = "kleisner1",
             .after = "question_id")



################################################################################################################################
lau_png <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/18po7Pgq5Od6Q8yCnFdSfj_Gaxii34e-WsYwBFA3RTvo/edit#gid=1980661832", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Lau",
             reference = "lau1",
             .after = "question_id")



###############################################################################################################################
mason_iceland <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1ZPs5ow4wpZgj5eP26jvoMRgD9q6VT9DEdkJfqj7UrRE/edit#gid=2142384281", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Mason",
             reference = "mason1",
             .after = "question_id")




##########################################################################################################################
mills_lobster <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1HEPT54TsR1aTNNzDtZI59zU0eb-eJfH61ujErxAFtiI/edit#gid=553950990", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Mills",
             reference = "mills1",
             .after = "question_id")



########################################################################################################################
pecl_lobster <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/11Z-SLlAS0f9Ug1Z8gLMnHkaN7hoZT1W0KMVLG8HtbXs/edit#gid=179679195", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Pecl",
             reference = "pecl1",
             .after = "question_id")



###########################################################################################################################
#schmidt_senegal <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1bUY6yII5y0FZfDRJ5lxpA7iD2p3o__2A1xsWivxwKB0/edit#gid=2000123802", 
#                           sheet = "UPDATED_S4_ResilienceAttributes",
#                           range = "A6:P61",
#                           col_names = TRUE,
#                           na = "",
#                           guess_max = 10000,
#                           trim_ws = TRUE,
#                           col_types = "c"
#                           ) %>%
#  as_tibble() %>%
#  clean_names() %>% 
#  add_column(case_study = "Schmidt",
#             reference = "schmidt1",
#             .after = "question_id") 



###############################################################################################################################
tokunaga_lobster <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1jgFZut693B14rdKbxprKtQcoh-mFlMzAktekjhvwf2Q/edit#gid=228934601", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Tokunaga",
             reference = "tokunaga1",
             .after = "question_id") 



############################################################################################################################
westfall_hms <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1DMx0Ux9Li1LhIe4ee5bbAYtJaw1vCezziRGyeERBthY/edit#gid=1818956842", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Westfall",
             reference = "westfall1",
             .after = "question_id")



###################################################################################################################################
zhao_moorea <- read_sheet(ss = "https://docs.google.com/spreadsheets/d/1-Muz76--fNv1qfdXZcBENP-agemTTySZAay9uAEO0HI/edit#gid=1980661832", 
                           sheet = "UPDATED_S4_ResilienceAttributes",
                           range = "A6:P61",
                           col_names = TRUE,
                           na = "",
                           guess_max = 10000,
                           trim_ws = TRUE,
                           col_types = "c"
                           ) %>%
  as_tibble() %>%
  clean_names() %>% 
  add_column(case_study = "Zhao",
             reference = "zhao1",
             .after = "question_id")
```


##############################################################################################

# Merge the datasets

```{r}
attributes_merged <- rbind(aguion_barnacle, burden_sardine, dickey_collas_eur, eurich_clam, free_crab, friedman_fiji, golden_madagascar, hollowed_bering_sea, kisara_squid, kleisner_jfi, lau_png, mason_iceland, mills_lobster, pecl_lobster, tokunaga_lobster, westfall_hms, zhao_moorea)

```


# Clean the merged datasets 

```{r}
attributes_merged_clean <- attributes_merged %>% 
  rename(dimension=dimensions, 
         domain=new_domain, 
         attribute=resilience_attribute, 
         score=score_1_4,
         quality=information_quality, 
         importance=importance_of_attribute_in_study_system_high_medium_low, 
         work_as_described=does_the_mechanism_work_as_described_in_this_fishery_system) %>% 
# Simplify
  select(dimension, domain, case_study, reference, attribute, score, quality, importance, work_as_described) %>% 
# Remove spacer rows
  filter(!is.na(attribute)) %>% 
# Format scores
  filter(!is.na(score)) %>% 
# In order to get rid of "NA" values that were purposefully entered into the data, I used the `case_when` function to revert
  mutate(official_score = case_when(
    score == "1" ~ "1",
    score == "2" ~ "2",
    score == "3" ~ "3",
    score == "4" ~ "4",
    score == "NA" ~ "0"
  )) %>% 
  mutate(official_score=as.numeric(official_score)) %>%
  # Formate dimension
  mutate(dimension=recode_factor(dimension, 
                                 "Ecological"="Ecological",
                                 "Socio-economic"="Social-economic",
                                 "Governance-management"="Goverance")) %>% 
# Format data quality
  mutate(quality=ifelse(quality=="NA - Not relevant in this system", NA, quality),
         quality=recode_factor(quality,
                               "E - No data/information; no basis for expert judgement"="No data", ### CF used "E - No data/information; no basis for expert judgement", but JE's was different
                               "D - not confident that the answer provided reflects the true state of the system"="Low",
                               "C - fairly confident that the answer provided reflects the true state of the system"="Fair",
                               "B - limited data/information and expert judgement"="Good",
                               "A - adequate and reliable data/information"="Excellent")) %>% 
  # Format importance
  mutate(importance=stringr::str_to_sentence(importance),
         importance=factor(importance, levels=c("Low", "Medium", "High"))) %>% 
  # Create a new column to house numeric values for importance
  mutate(numeric_importance = case_when(
    importance == "Low" ~ "1",
    importance == "Medium" ~ "2",
    importance == "High" ~ "3")) %>% 
  mutate(numeric_importance=as.numeric(numeric_importance)) %>% 
  filter(!is.na(numeric_importance))
  

```


############################################################################################

# Find Attribute Score Means 
The attribute score means of each attribute are reflected in the table. These means are based off of all case studies combined.

```{r}
# Build a table
merged_mean <- attributes_merged_clean %>% 
  group_by(attribute) %>% 
  summarise_at(vars(official_score), list(score = mean))

# Use `kableExtra` package to create table
merged_mean %>% 
  kbl(caption = "Resilience Attribute Score Means") %>% 
   kable_classic_2(full_width = F, html_font = "Cambria") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"))
```

## Score means by dimension

```{r}
# Find means across domains but within each dimension
dimension_mean <- attributes_merged_clean %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list("Mean" = mean, "Standard Deviaton" = sd)) %>% 
  rename(Dimension = dimension)

# Create a table
dimension_mean %>% 
  kbl(caption = "Attribute Score Means by Dimension") %>% 
   kable_classic_2(full_width = F, html_font = "Cambria") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"))
```

## Score means by domain

```{r}
# Find means across domains but within each dimension
domain_mean <- attributes_merged_clean %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean))

# Create a table
domain_mean %>% 
  kbl(caption = "Attribute Score Means by Domain") %>% 
   kable_classic_2(full_width = F, html_font = "Cambria") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"))
```



##############################################################################################

# Grouping Attribute Score Stats

## Attribute Score Means by Dimension
```{r}
# Create a table where the average scores of each domain across case studies are represented

# Aguion mean
aguion_dim <- attributes_merged_clean %>% 
  filter(case_study == "Aguion") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Aguion = score,
         Dimension=dimension) 

# Burden mean
burden_dim <- attributes_merged_clean %>% 
  filter(case_study == "Burden") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Burden = score)

# Dickey-Collas mean
dickey_collas_dim <- attributes_merged_clean %>% 
  filter(case_study == "Dickey_Collas") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Dickey_Collas = score) 

# Eurich mean
eurich_dim <- attributes_merged_clean %>% 
  filter(case_study == "Eurich") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Eurich = score)

# Free mean
free_dim <- attributes_merged_clean %>% 
  filter(case_study == "Free") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Free = score)

# Friedman mean
friedman_dim <- attributes_merged_clean %>% 
  filter(case_study == "Friedman") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Friedman = score)

# Hollowed mean
hollowed_dim <- attributes_merged_clean %>% 
  filter(case_study == "Hollowed") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Hollowed = score)

# Kisara mean
kisara_dim <- attributes_merged_clean %>% 
  filter(case_study == "Kisara") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Kisara = score)

# Kleisner mean
kleisner_dim <- attributes_merged_clean %>% 
  filter(case_study == "Kleisner") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Kleisner = score)

# Lau mean
lau_dim <- attributes_merged_clean %>% 
  filter(case_study == "Lau") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Lau = score)

# Mason mean
mason_dim <- attributes_merged_clean %>% 
  filter(case_study == "Mason") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Mason = score)

# Mills mean
mills_dim <- attributes_merged_clean %>% 
  filter(case_study == "Mills") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Mills = score)

# Pecl mean
pecl_dim <- attributes_merged_clean %>% 
  filter(case_study == "Pecl") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Pecl = score)

# Tokunaga mean
tokunaga_dim <- attributes_merged_clean %>% 
  filter(case_study == "Tokunaga") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Tokunaga = score)

# Westfall mean
westfall_dim <- attributes_merged_clean %>% 
  filter(case_study == "Westfall") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Westfall = score)

# Zhao mean
zhao_dim <- attributes_merged_clean %>% 
  filter(case_study == "Zhao") %>% 
  group_by(dimension) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Zhao = score)
```

```{r}
### Kisara Case Study missing b/c no information forsome of the dimensions 

# Merge all mean datasets together
dimension_means_merged <- cbind(aguion_dim, burden_dim, dickey_collas_dim, eurich_dim, free_dim, friedman_dim, hollowed_dim,  kleisner_dim, lau_dim, mason_dim, mills_dim, pecl_dim, tokunaga_dim, westfall_dim, zhao_dim) %>% 
  select(Dimension, Aguion, Burden, Dickey_Collas, Eurich, Free, Friedman, Hollowed, Kleisner, Lau, Mason, Mills, Pecl, Tokunaga, Westfall, Zhao) 


# Create a table
dimension_means_merged %>% 
  kbl(caption = "Attribute Score Means Across by Dimension") %>% 
   kable_classic_2(full_width = F, html_font = "Cambria") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"))
```


## Attribute Score Means by Domain

```{r}
# Create a table where the average scores of each domain across case studies are represented

# Aguion mean
aguion_mean <- attributes_merged_clean %>% 
  filter(case_study == "Aguion") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Aguion = score) 

# Burden mean
burden_mean <- attributes_merged_clean %>% 
  filter(case_study == "Burden") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Burden = score)

# Dickey-Collas mean
dickey_collas_mean <- attributes_merged_clean %>% 
  filter(case_study == "Dickey_Collas") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Dickey_Collas = score) 

# Eurich mean
eurich_mean <- attributes_merged_clean %>% 
  filter(case_study == "Eurich") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Eurich = score)

# Free mean
free_mean <- attributes_merged_clean %>% 
  filter(case_study == "Free") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Free = score)

# Friedman mean
friedman_mean <- attributes_merged_clean %>% 
  filter(case_study == "Friedman") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Friedman = score)

# Hollowed mean
hollowed_mean <- attributes_merged_clean %>% 
  filter(case_study == "Hollowed") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Hollowed = score)

# Kisara mean
kisara_mean <- attributes_merged_clean %>% 
  filter(case_study == "Kisara") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Kisara = score)

# Kleisner mean
kleisner_mean <- attributes_merged_clean %>% 
  filter(case_study == "Kleisner") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Kleisner = score)

# Lau mean
lau_mean <- attributes_merged_clean %>% 
  filter(case_study == "Lau") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Lau = score)

# Mason mean
mason_mean <- attributes_merged_clean %>% 
  filter(case_study == "Mason") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Mason = score)

# Mills mean
mills_mean <- attributes_merged_clean %>% 
  filter(case_study == "Mills") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Mills = score)

# Pecl mean
pecl_mean <- attributes_merged_clean %>% 
  filter(case_study == "Pecl") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Pecl = score)

# Tokunaga mean
tokunaga_mean <- attributes_merged_clean %>% 
  filter(case_study == "Tokunaga") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Tokunaga = score)

# Westfall mean
westfall_mean <- attributes_merged_clean %>% 
  filter(case_study == "Westfall") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Westfall = score)

# Zhao mean
zhao_mean <- attributes_merged_clean %>% 
  filter(case_study == "Zhao") %>% 
  group_by(dimension, domain) %>% 
  summarise_at(vars(official_score), list(score = mean)) %>% 
  rename(Zhao = score)
```

```{r}
### Kisara Case Study missing b/c no information forsome of the dimensions 

# Merge all mean datasets together
means_merged_by_case <- cbind(aguion_mean, burden_mean, dickey_collas_mean, eurich_mean, free_mean, friedman_mean, hollowed_mean,  kleisner_mean, lau_mean, mason_mean, mills_mean, pecl_mean, tokunaga_mean, westfall_mean, zhao_mean) %>% 
  select(dimension...1, domain...2, Aguion, Burden, Dickey_Collas, Eurich, Free, Friedman, Hollowed, Kleisner, Lau, Mason, Mills, Pecl, Tokunaga, Westfall, Zhao) %>% 
  rename(Dimension = dimension...1, Domain = domain...2)

# Create a table
means_merged_by_case %>% 
  kbl(caption = "Resilience Attribute Score Means Across Case Studies") %>% 
   kable_classic_2(full_width = F, html_font = "Cambria") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"))
```

####################################################################################################

# Visualize Attribute Score Means

```{r}
# Create theme
my_theme <-  theme(axis.text.x=element_text(size=7, angle=38, hjust=0.8),
                   axis.text.y=element_text(size=8),
                   legend.text=element_text(size=8),
                   legend.title=element_text(size=9),
                   strip.text=element_text(size=9),
                   # Gridlines
                   panel.grid.major = element_blank(), 
                   panel.grid.minor = element_blank(),
                   panel.background = element_rect(), 
                   axis.line = element_line())
```

```{r}
# Bar graph showing average comparison by dimension across case studies

dimension_comparison <- dimension_means_merged %>% 
  pivot_longer(!Dimension, names_to = "case_study", values_to = "means")


ggplot(dimension_comparison, aes(x = case_study, y = means, fill = Dimension)) +
  geom_bar(stat="identity", width=0.7, position=position_dodge(width=1)) +
  theme_bw() + my_theme +
  facet_wrap(~Dimension, scales = "free") +
  theme(legend.position="top") +
  geom_hline(data=dimension_mean, aes(yintercept = (Mean)), linetype="dashed", colour="black") +
  labs(x = "Case Studies", y = "Attribute Score Averages")
```


##################################################################################################

# Attribute Score Proportions

```{r}
# Create a table that shows the counts and proportions of attribute scores to help identify which are scoring higher than others and vice versa.

attribute_score_stats <- attributes_merged_clean %>% 
  select(dimension, score) %>% 
  count(dimension, score) 

attribute_score_counts <- attribute_score_stats %>% 
  tabyl(dimension, score, n)


%>% 
  mutate(n=as.numeric(n)) %>% 
  #slice(-c(9,14)) %>% 
  pivot_wider(names_from = c(score), values_from = n, values_fn = list) 
  

%>% 
  column_to_rownames(var = "dimension")
attribute_score_proportions <- attribute_score_counts %>% 
  adorn_percentages() 

%>% 
  adorn_pct_formatting(digits = 2) %>% 
  adorn_ns() %>% 
  select("dimension", "1", "2", "2", "4")
  

```



















